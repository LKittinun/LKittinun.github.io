<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>12 False discovery | A gentle introduction to R for biologists</title>
<meta name="author" content="Kittinun Leetanaporn">
<meta name="description" content="12.1 \(p\)-value histogram พิจารณา \(p\)-value histogram ที่เกิดจากการเปรียบเทียบ \(t\)-test ของกลุ่มตัวอย่างที่มาจากประชากรเดียวกัน ทั้งหมด 10,000 ครั้ง set.seed(123) same_dist &lt;- sapply(1:10000,...">
<meta name="generator" content="bookdown 0.36 with bs4_book()">
<meta property="og:title" content="12 False discovery | A gentle introduction to R for biologists">
<meta property="og:type" content="book">
<meta property="og:description" content="12.1 \(p\)-value histogram พิจารณา \(p\)-value histogram ที่เกิดจากการเปรียบเทียบ \(t\)-test ของกลุ่มตัวอย่างที่มาจากประชากรเดียวกัน ทั้งหมด 10,000 ครั้ง set.seed(123) same_dist &lt;- sapply(1:10000,...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="12 False discovery | A gentle introduction to R for biologists">
<meta name="twitter:description" content="12.1 \(p\)-value histogram พิจารณา \(p\)-value histogram ที่เกิดจากการเปรียบเทียบ \(t\)-test ของกลุ่มตัวอย่างที่มาจากประชากรเดียวกัน ทั้งหมด 10,000 ครั้ง set.seed(123) same_dist &lt;- sapply(1:10000,...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A gentle introduction to R for biologists</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome!</a></li>
<li class="book-part">Basic R</li>
<li><a class="" href="basic-r.html"><span class="header-section-number">1</span> Basic R</a></li>
<li><a class="" href="r-function.html"><span class="header-section-number">2</span> R function</a></li>
<li><a class="" href="loop.html"><span class="header-section-number">3</span> Loop</a></li>
<li class="book-part">Tidyverse</li>
<li><a class="" href="what-is-tidyverse.html"><span class="header-section-number">4</span> What is tidyverse</a></li>
<li><a class="" href="importing-data.html"><span class="header-section-number">5</span> Importing data</a></li>
<li><a class="" href="data-wrangling.html"><span class="header-section-number">6</span> Data wrangling</a></li>
<li><a class="" href="data-visualization-with-ggplot2.html"><span class="header-section-number">7</span> Data visualization with ggplot2</a></li>
<li><a class="" href="GSE63514.html"><span class="header-section-number">8</span> Example: Microarray data visualization</a></li>
<li class="book-part">Statistical analysis</li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">9</span> Hypothesis testing</a></li>
<li><a class="" href="parametric-test.html"><span class="header-section-number">10</span> Parametric test</a></li>
<li><a class="" href="non-parametric-test.html"><span class="header-section-number">11</span> Non-parametric test</a></li>
<li><a class="active" href="false-discovery.html"><span class="header-section-number">12</span> False discovery</a></li>
<li><a class="" href="regression-model.html"><span class="header-section-number">13</span> Regression model</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">14</span> Survival analysis</a></li>
<li><a class="" href="principal-component-analysis.html"><span class="header-section-number">15</span> Principal component analysis</a></li>
<li class="book-part">Bioconductor</li>
<li><a class="" href="bioconductor.html"><span class="header-section-number">16</span> Bioconductor</a></li>
<li><a class="" href="limma.html"><span class="header-section-number">17</span> Limma</a></li>
<li><a class="" href="edger.html"><span class="header-section-number">18</span> edgeR</a></li>
<li><a class="" href="pathway-analysis.html"><span class="header-section-number">19</span> Pathway analysis</a></li>
<li class="book-part">Supplement</li>
<li><a class="" href="distribution.html"><span class="header-section-number">20</span> Distribution</a></li>
<li class="book-part">Information</li>
<li><a class="" href="session-info.html"><span class="header-section-number">21</span> Session info</a></li>
<li><a class="" href="references.html"><span class="header-section-number">22</span> References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="false-discovery" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> False discovery<a class="anchor" aria-label="anchor" href="#false-discovery"><i class="fas fa-link"></i></a>
</h1>
<div id="p-value-histogram" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> <span class="math inline">\(p\)</span>-value histogram<a class="anchor" aria-label="anchor" href="#p-value-histogram"><i class="fas fa-link"></i></a>
</h2>
<p>พิจารณา <span class="math inline">\(p\)</span>-value histogram ที่เกิดจากการเปรียบเทียบ <span class="math inline">\(t\)</span>-test ของกลุ่มตัวอย่างที่มาจากประชากรเดียวกัน ทั้งหมด 10,000 ครั้ง</p>
<div class="sourceCode" id="cb354"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">same_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10000</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">10</span>,<span class="fl">4</span><span class="op">)</span>, </span>
<span>                                         <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">10</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span> <span class="co"># Mean 10 vs 10</span></span></code></pre></div>
<div class="inline-figure"><img src="figure/same_dist_plot-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>ท่านจะเห็นว่าการกระจายตัวของ <span class="math inline">\(p\)</span>-value นั่นมีลักษณะเป็น <a href="distribution.html#unif-dist">Uniform distribution</a> สังเกตว่าจะมีบางส่วนที่ <span class="math inline">\(p\)</span>-value น้อยกว่าค่าวิกฤติที่ตั้งไว้ ซึ่งในที่นี้คือ <span class="math inline">\(p\)</span> <span class="math inline">\(\leq\)</span> 0.05 ซึ่งจะเห็นว่ามีประมาณ 5% เหตุเพราะใน <span class="math inline">\(H_{0}\)</span> ที่ไม่มีความแตกต่างของค่าเฉลี่ยระหว่างประชากรนั้น มีโอกาสที่จะมีความแตกต่างที่มากกว่า 0 <a href="hypothesis-testing.html#p-crit">ได้ประมาณ 5% อยู่แล้ว</a> ซึ่งถือว่านี่คือ False positive</p>
<p>ส่วนอีกตัวอย่าง เป็นกลุ่มตัวอย่างสองกลุ่มที่มาจากประชากรที่ต่างกัน 100%</p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">very_diff_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10000</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">10</span>,<span class="fl">4</span><span class="op">)</span>, </span>
<span>                                         <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">15</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span><span class="op">)</span> <span class="co"># Mean 10 vs 15</span></span></code></pre></div>
<div class="inline-figure"><img src="figure/very_diff_dist-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>จะเห็นว่า <span class="math inline">\(p\)</span>-value นั้นจะมีการกระจายตัวที่ไม่เป็น <a href="distribution.html#unif-dist">Uniform distribution</a> นั่นเพราะความต่างของข้อมูลนั้น ได้อยู่ในระดับที่จะ ปฏิเสธ <span class="math inline">\(H_{0}\)</span> ได้อยู่แล้ว การทำการทดสอบหลายๆ ครั้ง จึงได้ผลที่ <span class="math inline">\(p\)</span>-value <span class="math inline">\(\leq\)</span> 0.05 นั้นอยู่ที่ระดับใกล้ 0</p>
<p>สุดท้ายจะทำการจำลองข้อมูลจากการทดลอง 10,000 ครั้งที่มี อัตรา True positive 20% และทดสอบที่ <span class="math inline">\(\alpha\)</span> = 0.05</p>
<div class="sourceCode" id="cb356"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">num_tests</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">true_positives</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span>  </span>
<span></span>
<span><span class="va">null_pvalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">num_tests</span> <span class="op">-</span> <span class="va">true_positives</span><span class="op">)</span> <span class="co"># Null p-value</span></span>
<span><span class="va">alt_pvalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">true_positives</span>, <span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span> <span class="co"># True p-value</span></span>
<span><span class="va">all_pvalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">null_pvalues</span>, <span class="va">alt_pvalues</span><span class="op">)</span> <span class="co"># All p-value</span></span></code></pre></div>
<p>เมื่อท่านคำนวณ % ของ Rejected <span class="math inline">\(p\)</span>-value จะได้ว่า</p>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rejected_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">all_pvalues</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">all_pvalues</span><span class="op">)</span></span>
<span><span class="va">rejected_p</span><span class="op">*</span><span class="fl">100</span></span></code></pre></div>
<pre><code>## [1] 24.19</code></pre>
<p><span class="math inline">\(p\)</span>-value ที่ถูก Reject <span class="math inline">\(H_{0}\)</span> มีมากถึง 24%! เมื่อเทียบกับ True positive ซึ่งมีเพียง 20% เท่านั้น</p>
<p>เมื่อมาลองพล็อต <span class="math inline">\(p\)</span>-value histogram</p>
<div class="inline-figure"><img src="figure/true20-1.png" width="70%" style="display: block; margin: auto;"></div>
<p>ในที่นี้ <strong>พื้นที่</strong>สีเขียวคือ True positive สีแดงเข้มคือ False positive และสีแดงอ่อน คือ True negative จะได้ว่าอัตราส่วนผลบวกลวง (False discovery proprotion) คือ</p>
<p><span class="math display">\[
FDP = \frac{TP}{TP +FP}
\]</span></p>
<p>จะสังเกตว่าถ้าทำการทดสอบไม่กี่ครั้ง เช่น 10 ครั้ง 5% ไม่ได้มีความหมายมาก (0.05 <span class="math inline">\(\times\)</span> 10 = 0.5 ครั้ง ไม่ถึง 1 ด้วยซ้ำ) แต่ถ้าท่านทำการทดสอบนี้ 10,000 ครั้ง ท่านมีโอกาสที่จะพบ False positive ถึง 0.05 <span class="math inline">\(\times\)</span> 10,000 ~ 500 ครั้ง! ซึ่งนับว่าอันตรายกับกระเป๋าเงินของท่านมากเมื่อนำผลนี้ไป Validate ด้วยการทดลองวิธีอื่น โดยเฉพาะผลจากงาน High-throughput ที่มีการทดสอบสมมตติฐานนับพันนับหมื่นครั้ง (ตามจำนวนยีน/โปรตีน)</p>
<hr>
</div>
<div id="dealing-with-false-discovery" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> Dealing with false discovery<a class="anchor" aria-label="anchor" href="#dealing-with-false-discovery"><i class="fas fa-link"></i></a>
</h2>
<p>จะเห็นว่าสถานการณ์ขั้นต้นเป็นสถานการณ์ที่ไม่น่าอภิรมย์นัก เมื่อจะต้องนำข้อมูลไป Validate ซึ่งนับเป็นโชคดีที่นักสถิติได้คิดค้นวิธีต่างๆ ขึ้นมาเพื่อพยายามปรับอัตราของผลบวกลวงนี้ให้ลดลงก่อนจะไปเสียหายในการทดลองจริง ซึ่งวิธีการมีดังนี้</p>
<div id="family-wise-error-rate-fwer" class="section level3" number="12.2.1">
<h3>
<span class="header-section-number">12.2.1</span> Family-wise error rate (FWER)<a class="anchor" aria-label="anchor" href="#family-wise-error-rate-fwer"><i class="fas fa-link"></i></a>
</h3>
<p>คือ โอกาสที่จะเกิดความผิดพลาดอย่างน้อย 1 ครั้งจากการทดสอบทั้งหมด</p>
<p><span class="math display">\[
FWER(\alpha) = 1- \prod_{j=1}^{m}(1-\alpha) = 1-(1-\alpha)^m
\]</span></p>
<p>ตัวอย่างเช่น ที่ <span class="math inline">\(\alpha\)</span> = 0.05 ถ้าท่านทำการทดลอง 100 ครั้ง ท่านมีโอกาสที่จะเกิด False positive 1 ครั้ง ถึง <span class="math inline">\(1-(1-0.05)^{100} = 0.994\)</span> = 99%</p>
<p>เมื่อทำการเปรียบเทียบที่ <span class="math inline">\(\alpha\)</span> Threshold ต่างๆ จะได้ว่า</p>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FWER</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span><span class="op">(</span>times <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">500</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.005</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>FWER <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">alpha</span><span class="op">)</span><span class="op">^</span><span class="va">times</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">FWER</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">times</span>, y <span class="op">=</span> <span class="va">FWER</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"No. of hypothesis"</span>, col <span class="op">=</span> <span class="st">"alpha"</span>, linetype <span class="op">=</span> <span class="st">"alpha"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="figure/fwer_plot-1.png" width="672"></div>
</div>
<div id="controlling-fwer" class="section level3" number="12.2.2">
<h3>
<span class="header-section-number">12.2.2</span> Controlling FWER<a class="anchor" aria-label="anchor" href="#controlling-fwer"><i class="fas fa-link"></i></a>
</h3>
<p>การควบคุม FWER นั้น คือการปรับเปลี่ยนที่ <span class="math inline">\(\alpha\)</span> โดยตรง</p>
<div id="bonferroni" class="section level4" number="12.2.2.1">
<h4>
<span class="header-section-number">12.2.2.1</span> Bonferroni<a class="anchor" aria-label="anchor" href="#bonferroni"><i class="fas fa-link"></i></a>
</h4>
<p>คือการเพิ่ม Threshold ของ <span class="math inline">\(\alpha\)</span> โดยตรง</p>
<p><span class="math display">\[
FWER(\alpha) \leq m \times \frac{\alpha}{m} = \alpha
\]</span></p>
<p>กล่าวโดยง่ายก็คือการปรับ Threshold ของ <span class="math inline">\(\alpha\)</span> ตามจำนวนครั้งที่ทดสอบนั่นเอง เช่น <span class="math inline">\(\alpha\)</span> เดิม = 0.05 ทดสอบ 10 ครั้ง <span class="math inline">\(\alpha\)</span> ที่ควรจะเป็นคือ 0.005 หรือคิดในทางกลับกัน คือ <span class="math inline">\(p\)</span>-value ใหม่ = <span class="math inline">\(m \times p_{org}\)</span></p>
<p>ยกตัวอย่าง <span class="math inline">\(p\)</span>-value ที่ <span class="math inline">\(\alpha\)</span> เดิม = 0.05</p>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pval_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>hypo <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, </span>
<span>                      pval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.75</span>, <span class="fl">0.045</span>, <span class="fl">0.1</span>, <span class="fl">0.012</span><span class="op">)</span>, </span>
<span>                      alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>original_reject <span class="op">=</span> <span class="va">pval</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pval_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>adj_p <span class="op">=</span> <span class="va">pval</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># new treshold</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>reject <span class="op">=</span> <span class="va">adj_p</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["hypo"],"name":[1],"type":["chr"],"align":["left"]},{"label":["pval"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["alpha"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["original_reject"],"name":[4],"type":["lgl"],"align":["right"]},{"label":["adj_p"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["reject"],"name":[6],"type":["lgl"],"align":["right"]}],"data":[{"1":"A","2":"0.010","3":"0.05","4":"TRUE","5":"0.050","6":"TRUE"},{"1":"B","2":"0.750","3":"0.05","4":"FALSE","5":"3.750","6":"FALSE"},{"1":"C","2":"0.045","3":"0.05","4":"TRUE","5":"0.225","6":"FALSE"},{"1":"D","2":"0.100","3":"0.05","4":"FALSE","5":"0.500","6":"FALSE"},{"1":"E","2":"0.012","3":"0.05","4":"TRUE","5":"0.060","6":"FALSE"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="holms-stepdown-procedure" class="section level4" number="12.2.2.2">
<h4>
<span class="header-section-number">12.2.2.2</span> Holm’s stepdown procedure<a class="anchor" aria-label="anchor" href="#holms-stepdown-procedure"><i class="fas fa-link"></i></a>
</h4>
<p>คือการตั้ง Threshold ของ <span class="math inline">\(\alpha\)</span> ให้สูงขึ้นเรื่อยๆ ตามจำนวนครั้งที่ทดสอบ ซึ่งมีหลักการ คือ</p>
<ol style="list-style-type: decimal">
<li>เรียง <span class="math inline">\(p\)</span>-value จากน้อยไปมาก</li>
<li>สร้าง <span class="math inline">\(\alpha\)</span> Criteria ใหม่โดย <span class="math inline">\(\alpha_{new_{j}} = \frac{\alpha}{m+1-j}\)</span> เมื่อ <span class="math inline">\(m\)</span> คือ จำนวน <span class="math inline">\(p\)</span> ทั้งหมด และ <span class="math inline">\(j\)</span> คือ ลำดับของ <span class="math inline">\(p\)</span>-value</li>
</ol>
<p>ต่อไปจะลองใช้ข้อมูลเดิมมาปรับ <span class="math inline">\(\alpha\)</span> แบบ Holm’s</p>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pval_df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sequence <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">pval</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># sort p-val</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># assign rank</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>new_alpha <span class="op">=</span> <span class="va">alpha</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">-</span><span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># new threshold</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>reject <span class="op">=</span> <span class="va">pval</span> <span class="op">&lt;=</span> <span class="va">new_alpha</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">sequence</span><span class="op">)</span> <span class="co"># sort back to original order</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["hypo"],"name":[1],"type":["chr"],"align":["left"]},{"label":["pval"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["alpha"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["original_reject"],"name":[4],"type":["lgl"],"align":["right"]},{"label":["sequence"],"name":[5],"type":["int"],"align":["right"]},{"label":["rank"],"name":[6],"type":["int"],"align":["right"]},{"label":["new_alpha"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["reject"],"name":[8],"type":["lgl"],"align":["right"]}],"data":[{"1":"A","2":"0.010","3":"0.05","4":"TRUE","5":"1","6":"1","7":"0.01000000","8":"TRUE"},{"1":"B","2":"0.750","3":"0.05","4":"FALSE","5":"2","6":"5","7":"0.05000000","8":"FALSE"},{"1":"C","2":"0.045","3":"0.05","4":"TRUE","5":"3","6":"3","7":"0.01666667","8":"FALSE"},{"1":"D","2":"0.100","3":"0.05","4":"FALSE","5":"4","6":"4","7":"0.02500000","8":"FALSE"},{"1":"E","2":"0.012","3":"0.05","4":"TRUE","5":"5","6":"2","7":"0.01250000","8":"TRUE"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>จะเห็นว่าทั้งสองวิธีขั้นต้นนั้นเป็นวิธีที่ Conservative มาก และมีข้อเสียคือ Power นั้นจะลดลงอย่างรวดเร็วตามจำนวนครั้งที่ทดสอบ</p>
</div>
</div>
</div>
<div id="false-discovery-rate-fdr" class="section level2" number="12.3">
<h2>
<span class="header-section-number">12.3</span> False discovery rate (FDR)<a class="anchor" aria-label="anchor" href="#false-discovery-rate-fdr"><i class="fas fa-link"></i></a>
</h2>
<p>จะเห็นว่า FWER นั้นมีข้อเสียมากเกินไป จึงมีวิธีการที่ Conservative น้อยกว่า โดยจะไปควบคุม FDP แทน ตามที่เคยกล่าวไปต้นบท</p>
<p>อย่างไรก็ตาม ในการทดลองจริงนั้น ไม่มีทางที่จะสามารถประเมิน FDP ได้เนื่องจากไม่มีทางทราบว่า อัตราส่วนของ True positive เป็นเท่าไร จึงจำเป็นต้องใช้การประมาณของ FDP ภายใต้ขอบเขตความรู้ที่มีอยู่แทน จะได้ว่า</p>
<p><span class="math display">\[
FDR = E(FDP) = E(\frac{TP}{TP+FP})
\]</span></p>
<div id="controlling-fdr" class="section level3" number="12.3.1">
<h3>
<span class="header-section-number">12.3.1</span> Controlling FDR<a class="anchor" aria-label="anchor" href="#controlling-fdr"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="benjaminis-hochberg" class="section level3" number="12.3.2">
<h3>
<span class="header-section-number">12.3.2</span> Benjamini’s Hochberg<a class="anchor" aria-label="anchor" href="#benjaminis-hochberg"><i class="fas fa-link"></i></a>
</h3>
<p>เป็นวิธีที่นิยมใช้ที่สุดในการควบคุม FDR โดยมีวิธีคือ</p>
<ol style="list-style-type: decimal">
<li>เรียง <span class="math inline">\(p\)</span>-value จากมากไปน้อย</li>
<li>
<span class="math inline">\(p_{new}\)</span> มากที่สุด = 1</li>
<li>คำนวน <span class="math inline">\(p_{new_{j}} = cummin(1, \frac{m}{j} \times p)\)</span> (Cumulative min)</li>
</ol>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pval_df</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">pval</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># rank of pval</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sequence <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># original sequence</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">pval</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># arrange p</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>adj_p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cummin</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">*</span><span class="va">pval</span><span class="op">/</span><span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># cumulative min</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>adj_p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">adj_p</span> <span class="op">&gt;</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="va">adj_p</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># limit at 1</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">sequence</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>reject <span class="op">=</span> <span class="va">adj_p</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["hypo"],"name":[1],"type":["chr"],"align":["left"]},{"label":["pval"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["alpha"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["original_reject"],"name":[4],"type":["lgl"],"align":["right"]},{"label":["rank"],"name":[5],"type":["int"],"align":["right"]},{"label":["sequence"],"name":[6],"type":["int"],"align":["right"]},{"label":["adj_p"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["reject"],"name":[8],"type":["lgl"],"align":["right"]}],"data":[{"1":"A","2":"0.010","3":"0.05","4":"TRUE","5":"1","6":"1","7":"0.030","8":"TRUE"},{"1":"B","2":"0.750","3":"0.05","4":"FALSE","5":"5","6":"2","7":"0.750","8":"FALSE"},{"1":"C","2":"0.045","3":"0.05","4":"TRUE","5":"3","6":"3","7":"0.075","8":"FALSE"},{"1":"D","2":"0.100","3":"0.05","4":"FALSE","5":"4","6":"4","7":"0.125","8":"FALSE"},{"1":"E","2":"0.012","3":"0.05","4":"TRUE","5":"2","6":"5","7":"0.030","8":"TRUE"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>ซึ่งวิธีนี้คือการควบคุมที่ระดับ FDR เนื่องจากไม่ได้เปลี่ยน <span class="math inline">\(\alpha\)</span> แต่ลดจำนวน Positive ตาม % ของข้อมูล</p>
<hr>
</div>
</div>
<div id="adjust-p-in-r" class="section level2" number="12.4">
<h2>
<span class="header-section-number">12.4</span> Adjust <span class="math inline">\(p\)</span> in R<a class="anchor" aria-label="anchor" href="#adjust-p-in-r"><i class="fas fa-link"></i></a>
</h2>
<p>ท่านไม่ต้องทำวิธีนี้ทั้งหมดด้วยตนเอง เนื่องจาก <code>R</code> มี <code><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust()</a></code> ไว้ให้อยู่แล้ว</p>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pval_df</span><span class="op">$</span><span class="va">pval</span></span></code></pre></div>
<pre><code>## [1] 0.010 0.750 0.045 0.100 0.012</code></pre>
<div class="sourceCode" id="cb365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">pval_df</span><span class="op">$</span><span class="va">pval</span>, method <span class="op">=</span> <span class="st">"bonferroni"</span><span class="op">)</span> </span></code></pre></div>
<pre><code>## [1] 0.050 1.000 0.225 0.500 0.060</code></pre>
<div class="sourceCode" id="cb367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">pval_df</span><span class="op">$</span><span class="va">pval</span>, method <span class="op">=</span> <span class="st">"BH"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 0.030 0.750 0.075 0.125 0.030</code></pre>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="non-parametric-test.html"><span class="header-section-number">11</span> Non-parametric test</a></div>
<div class="next"><a href="regression-model.html"><span class="header-section-number">13</span> Regression model</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#false-discovery"><span class="header-section-number">12</span> False discovery</a></li>
<li><a class="nav-link" href="#p-value-histogram"><span class="header-section-number">12.1</span> \(p\)-value histogram</a></li>
<li>
<a class="nav-link" href="#dealing-with-false-discovery"><span class="header-section-number">12.2</span> Dealing with false discovery</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#family-wise-error-rate-fwer"><span class="header-section-number">12.2.1</span> Family-wise error rate (FWER)</a></li>
<li><a class="nav-link" href="#controlling-fwer"><span class="header-section-number">12.2.2</span> Controlling FWER</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#false-discovery-rate-fdr"><span class="header-section-number">12.3</span> False discovery rate (FDR)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#controlling-fdr"><span class="header-section-number">12.3.1</span> Controlling FDR</a></li>
<li><a class="nav-link" href="#benjaminis-hochberg"><span class="header-section-number">12.3.2</span> Benjamini’s Hochberg</a></li>
</ul>
</li>
<li><a class="nav-link" href="#adjust-p-in-r"><span class="header-section-number">12.4</span> Adjust \(p\) in R</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A gentle introduction to R for biologists</strong>" was written by Kittinun Leetanaporn. It was last built on 2023-11-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
